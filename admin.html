<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin – Esercitazioni Digitali</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding-top: 70px; background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%); }
    .section-title { font-weight: 700; color: #2c3e50; margin-bottom: 1.5rem; letter-spacing: 1px; }
    .footer { background: #2c3e50; color: #fff; padding: 24px 0 12px 0; font-size: 1rem; letter-spacing: 1px; }
    .admin-box { background: #fff; border-radius: 16px; box-shadow: 0 2px 12px rgba(44,62,80,0.08); padding: 30px; max-width: 500px; margin: 40px auto; }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <div class="container">
    <a class="navbar-brand" href="index.html">Prof.ssa Assunta Santaniello</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="chisono.html">Chi sono</a></li>
        <li class="nav-item"><a class="nav-link" href="esercizi.html">Esercizi</a></li>
        <li class="nav-item"><a class="nav-link" href="guide.html">Guide</a></li>
        <li class="nav-item"><a class="nav-link" href="contatti.html">Contatti</a></li>
        <li class="nav-item"><a class="nav-link active" href="admin.html">Admin</a></li>
      </ul>
    </div>
  </div>
</nav>
<section class="container admin-box">
  <h2 class="section-title">Area Admin</h2>
  <div id="login-box">
    <p>Inserisci la password per accedere:</p>
    <input type="password" id="admin-password" class="form-control mb-2" placeholder="Password">
    <button class="btn btn-primary" onclick="checkPassword()">Accedi</button>
    <div id="login-error" class="text-danger mt-2" style="display:none;">Password errata!</div>
  </div>
  <div id="form-box" style="display:none;">
    <form id="novita-form">
            <div class="mb-3">
                    <div class="mb-3">
                      <label for="riferimenti" class="form-label">Riferimenti utili (uno per riga, es. link YouTube, pagine, siti)</label>
                      <textarea class="form-control" id="riferimenti" name="riferimenti" rows="3" placeholder="https://youtube.com/...\nhttps://paginautile.it/...\n..."></textarea>
                    </div>
              <label for="allegato" class="form-label">Allega un file</label>
            <span class="form-text text-muted" style="margin-left:10px;">Formati: PDF, PNG, JPG, JPEG, DOCX. Max 5MB.</span>

              <input type="file" class="form-control" id="allegato" name="allegato">
            </div>
      <div class="mb-3">
        <label for="tipo" class="form-label">Tipo</label>
        <select class="form-select" id="tipo" required>
          <option value="esercizio">Esercizio</option>
          <option value="guida">Guida</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="categoria" class="form-label">Categoria</label>
        <select class="form-select mb-2" id="categoria-select">
          <!-- Le categorie verranno caricate qui -->
        </select>
        <input type="text" class="form-control mt-2" id="categoria-custom" placeholder="Nuova categoria" style="display:none;">
        <button type="button" class="btn btn-link p-0" id="add-categoria-btn">Non trovi la tua categoria?</button>
      </div>
      <div class="mb-3">
        <label for="titolo" class="form-label">Titolo</label>
        <input type="text" class="form-control" id="titolo" required>
      </div>
      <div class="mb-3">
        <label for="descrizione" class="form-label">Descrizione</label>
        <textarea class="form-control" id="descrizione" rows="2" required></textarea>
      </div>
      <!-- Campo link rimosso: ora la data viene inserita automaticamente -->
      <!-- Campo testo bottone rimosso: ora gestito automaticamente -->
      <button type="submit" class="btn btn-success">Aggiungi</button>
    </form>
    <div id="form-success" class="text-success mt-3" style="display:none;">Elemento aggiunto! (Solo locale, aggiorna novita.json manualmente se non funziona)</div>
  </div>
</section>
<footer class="footer text-center">
  <div class="container">
    <div class="mb-2">© 2025 Prof. Assunta Santaniello– Tutti i diritti riservati</div>

  </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Password semplice lato client (solo per uso locale)
const ADMIN_PASSWORD = "assunta2025";
function checkPassword() {
  const input = document.getElementById('admin-password').value;
  if (input === ADMIN_PASSWORD) {
    document.getElementById('login-box').style.display = 'none';
    document.getElementById('form-box').style.display = 'block';
    caricaCategorie();
  } else {
    document.getElementById('login-error').style.display = 'block';
  }
}

// Carica le categorie esistenti da novita.json
function caricaCategorie() {
  fetch('novita.json')
    .then(response => response.json())
    .then(data => {
      const categorie = Array.from(new Set(data.map(n => n.categoria).filter(Boolean)));
      const select = document.getElementById('categoria-select');
      select.innerHTML = '';
      categorie.forEach(cat => {
        const opt = document.createElement('option');
        opt.value = cat;
        opt.textContent = cat;
        select.appendChild(opt);
      });
      // Opzione di default se non ci sono categorie
      if (categorie.length === 0) {
        const opt = document.createElement('option');
        opt.value = '';
        opt.textContent = 'Nessuna categoria';
        select.appendChild(opt);
      }
    });
}

// Mostra campo per nuova categoria
document.getElementById('add-categoria-btn').addEventListener('click', function() {
  document.getElementById('categoria-select').style.display = 'none';
  document.getElementById('categoria-custom').style.display = 'block';
});

// Form per aggiungere esercizi o guide tramite API backend
document.getElementById('novita-form')?.addEventListener('submit', function(e) {
  e.preventDefault();
  const tipo = document.getElementById('tipo').value;
  const titolo = document.getElementById('titolo').value;
  const descrizione = document.getElementById('descrizione').value;
  const oggi = new Date();
  const data = oggi.toISOString().slice(0, 10);
  let categoria = '';
  if (document.getElementById('categoria-custom').style.display === 'block') {
    categoria = document.getElementById('categoria-custom').value;
  } else {
    categoria = document.getElementById('categoria-select').value;
  }
  let testoBottone = '';
  if (tipo === 'guida') {
    testoBottone = 'Leggi la guida';
  } else if (tipo === 'esercizio') {
    testoBottone = 'Vai all’esercizio';
  } else {
    testoBottone = 'Scopri di più';
  }
  const allegatoInput = document.getElementById('allegato');
  const riferimentiInput = document.getElementById('riferimenti');
  const formData = new FormData();
  formData.append('tipo', tipo);
  formData.append('categoria', categoria);
  formData.append('titolo', titolo);
  formData.append('descrizione', descrizione);
  formData.append('testoBottone', testoBottone);
  formData.append('data', data);
  if (allegatoInput.files.length > 0) {
    const file = allegatoInput.files[0];
    const allowedTypes = [
      'application/pdf',
      'image/png',
      'image/jpg',
      'image/jpeg',
      'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
    ];
    const maxSize = 5 * 1024 * 1024; // 5MB
    if (!allowedTypes.includes(file.type)) {
      document.getElementById('form-success').textContent = 'Formato allegato non consentito.';
      document.getElementById('form-success').style.display = 'block';
      return;
    }
    if (file.size > maxSize) {
      document.getElementById('form-success').textContent = 'Allegato troppo grande (max 5MB).';
      document.getElementById('form-success').style.display = 'block';
      return;
    }
    formData.append('allegato', file);
  }
  if (riferimentiInput.value.trim() !== '') {
    // invia come stringa separata da \n
    formData.append('riferimenti', riferimentiInput.value.trim());
  }
  fetch('/api/novita', {
    method: 'POST',
    body: formData
  })
    .then(response => response.json())
    .then(result => {
      if (result.success) {
        document.getElementById('form-success').style.display = 'block';
      } else {
        document.getElementById('form-success').textContent = 'Errore!';
        document.getElementById('form-success').style.display = 'block';
      }
    })
    .catch(() => {
      document.getElementById('form-success').textContent = 'Errore di connessione!';
      document.getElementById('form-success').style.display = 'block';
    });
});
</script>
</body>
</html>